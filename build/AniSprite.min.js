/*
* AniSprite v.0.1.10
* Wes Jones. MIT 2014
*/
!function(a,b){function c(a,b,c){function e(a,b,c,d){this.x=a,this.y=b,this.radius=c,this.name=d}function f(){for(var a in b.frames)b.frames[a].name=a}function g(){for(var a in c){var b=c[a];H[b]=!1,I[b.key]=a}}function h(a){H[a]=!0}function i(a){H[a]=!1}function j(a){var b=a.keyCode;console.log(b),I[b]&&h(I[b])}function k(a){var b=a.keyCode;I[b]&&i(I[b])}function l(){for(var a in H)if(H[a])return void c[a].action();p.index>=x.frames.length-1&&p.play("stance")}function m(a,b){var c=0,d=0;return c=b.x-a.x,c*=c,d=b.y-a.y,d*=d,Math.sqrt(c+d)}function n(){var c,d,e,f,g;if(x.dependencies){for(f=0,e=[];f<x.dependencies.length;)g="function"==typeof x.dependencies[f]?x.dependencies[f]():x.dependencies[f],g&&(e=e.concat.apply(e,v[x.dependencies[f]].frames)),f+=1;e=e.concat.apply(e,x.frames)}else c=x,e=c.frames;e[y]||(y=0,z=0,c=x,e=c.frames),d=e[y],0===y&&c.start&&c.start(c),d.before&&d.before(c),r+=A,s>q?B+=E*F:(B=0,q=s),q+=B,D&&(A*=D,D>A&&(A=0,D=0)),o||(o=document.getElementsByClassName(a)[0],o.classList.add(b.name),o.style.position="absolute"),o&&(o.style.webkitTransform=t?"scaleX(-1)":"",o.style.backgroundPosition=d.x+"px "+d.y+"px",o.style.width=d.width+"px",o.style.height=d.height+2+"px",o.style.top=q+(d.oy||0)-d.height+"px",o.style.left=r+(p.reverse?-d.width:0)+(d.ox?p.reverse?-1*d.ox:d.ox:0)+"px"),d.wait&&z<d.wait?z+=1:(y+=1,z=0),d.after&&d.after(c),y===e.length&&c.end&&z>=c.wait&&c.end(c)}var o,p=this,q=100,r=100,s=500,t=!1,u=!1,v=b.frames,w=v.stance,x=w,y=0,z=0,A=0,B=0,C=0,D=0,E=.8,F=5,G=[];f();var H={},I={};g(),window.addEventListener("keydown",j),window.addEventListener("keyup",k),this.start=h,this.stop=i,this.actions=c,this.__defineGetter__("name",function(){return a}),this.__defineGetter__("frames",function(){return v}),this.__defineSetter__("frames",function(a){v=a}),this.__defineGetter__("index",function(){return y}),this.__defineSetter__("index",function(a){y=a}),this.__defineGetter__("y",function(){return q}),this.__defineSetter__("y",function(a){q=isNaN(a)?0:a}),this.__defineGetter__("ground",function(){return s}),this.__defineSetter__("ground",function(a){s=isNaN(a)?0:a}),this.__defineGetter__("x",function(){return r}),this.__defineSetter__("x",function(a){r=isNaN(a)?0:a}),this.__defineGetter__("reverse",function(){return t}),this.__defineSetter__("reverse",function(a){a=!!a,t!==a&&(A*=-1,r+=x.frames[0].width*(t?-1:1)),t=a}),this.__defineGetter__("ducked",function(){return u}),this.__defineSetter__("ducked",function(a){u=!!a}),this.__defineGetter__("speed",function(){return A}),this.__defineSetter__("speed",function(a){A=a}),this.__defineGetter__("speedY",function(){return B}),this.__defineSetter__("speedY",function(a){B=a}),this.__defineGetter__("damage",function(){return C}),this.__defineSetter__("damage",function(a){C=a}),this.__defineGetter__("friction",function(){return D}),this.__defineSetter__("friction",function(a){D=a}),this.__defineGetter__("gravity",function(){return E}),this.__defineSetter__("gravity",function(a){E=a}),this.__defineGetter__("wait",function(){return z}),this.__defineGetter__("defaultAni",function(){return w}),this.__defineSetter__("defaultAni",function(a){w=a}),this.play=function(a){v[a]!==x&&(v[a]&&s>q&&!v[a].inAir||x.frames[y]&&x.frames[y].immune||(x=v[a]||v.stance,y=0,z=0))},this.restoreDefault=function(){w=v.stance},this.createSpot=function(a,b,c,d){return new e(a,b,c,d)},this.strike=function(a,b,c,d,e){this.reverse?c-=b.width:c=b.width-c,this.dispatch("strike",a.name,this.createSpot(this.x+c,this.y-b.height+d,e))},this.weakSpots=function(a,b,c){var d,e=0,f=c.length;for(G.length=0;f>e;)d=c[e],d.x=this.reverse?this.x+d.x-b.width:this.x+b.width-d.x,d.y=this.y-b.height+d.y,G[e]=d,e+=1;this.dispatch("weakSpots",a.name,c)},this.checkHit=function(a,b,c){for(var d,e,f=0,g=G.length,h=0,i=100,j=-1;g>f;)d=G[f],h=m(a,d),h<a.radius+d.radius&&i>h&&(j=f),i=h,f+=1;return-1!==j?(C+=b,A+=t?c:-c,D=.25,e="function"==typeof G[j].name?G[j].name(b,c):G[j].name,void(e&&this.play(e))):void 0},belt.async.dispatcher(this),d.on(d.events.UPDATE,l),d.on(d.events.UPDATE,n)}b.ani=a,function(a,b){b.belt=a;var c={};c.dispatcher=function(a,b,c){function d(a,b){var c,d;d=j[a],d&&(b?(c=d.indexOf(b),-1!==c&&d.splice(c,1)):d.length=0)}function e(a,b){return j[a]=j[a]||[],j[a].push(b),function(){d(a,b)}}function f(c,f){function g(){d(c,g),f.apply(b||a,arguments)}return e(c,g)}function g(a){return j[a]}function h(b,c){return b&&b.apply(a,c)}function i(a){if(j[a])for(var b=0,c=j[a],d=c.length;d>b;)h(c[b],arguments),b+=1}var j={};b&&c?(a.on=b[c.on]&&b[c.on].bind(b),a.off=b[c.off]&&b[c.off].bind(b),a.once=b[c.once]&&b[c.once].bind(b),a.dispatch=b[c.dispatch].bind(b)):(a.on=e,a.off=d,a.once=f,a.dispatch=i),a.getListeners=g},a.async=c}({},function(){return this}());var d=function(){function a(){c.dispatch(c.events.UPDATE)}var b,c={};return c.events={UPDATE:"aniSpriteEngine:update"},c.start=function(d){d=d||60,c.stop(),b=setInterval(a,1e3/d)},c.stop=function(){clearInterval(b)},c.step=a,belt.async.dispatcher(c),c}();a.engine=d,a.AniSprite=c}({},function(){return this}());